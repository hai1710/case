<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SNAKE</title>
    <style>
        canvas {
            padding: 0;
            margin: auto;
            display: block;
            width: 750px;
            height: 750px;
        }
    </style>
</head>
<body style="background-image: url('ki.jpg') ">
<canvas id="canvas" style="border:5px solid cadetblue"></canvas>
;
<script>

    const canvas = document.getElementById("canvas");
    const gameSize = 600;
    const unit = 20;
    canvas.width = gameSize;
    canvas.height = gameSize;
    const ctx = canvas.getContext('2d');
    const backgroudColor = `black`;
    ctx.fillStyle = backgroudColor;
    ctx.fillRect(0, 0, gameSize, gameSize);
        const snakeColor = `
        `;
    const gameDelay = 100

    const left = 37;
    const up = 38;
    const right = 39;
    const down = 40;

    class taoDo {
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }
    }

    let currentDirection = new taoDo(-1, 0);

    class Snake {
        constructor() {
            this.body = [
                new taoDo(unit * 6, unit * 3),
                new taoDo(unit * 7, unit * 3),
                new taoDo(unit * 8, unit * 3),
            ]
            this.head = this.body[0]
            this.speed = new taoDo(-1, 0);
        }

        draw() {
            ctx.fillStyle = 'blue';
            ctx.fillRect(this.body[0].x, this.body[0].y, unit, unit);
            ctx.fillStyle = snakeColor;
            for (let i = 1; i < this.body.length; i++) {
                ctx.fillRect(this.body[i].x, this.body[i].y, unit, unit);
            }
        }

        clear() {
            ctx.fillStyle = backgroudColor;
            ctx.fillRect(this.body[0].x, this.body[0].y, unit, unit);
            ctx.fillStyle = backgroudColor;
            for (let i = 1; i < this.body.length; i++) {
                ctx.fillRect(this.body[i].x, this.body[i].y, unit, unit);
            }
        }

        handleBound() {
            if (this.head.x < 0) {
                this.head.x = gameSize - unit;
            }
            if (this.head.x > gameSize - unit) {
                this.head.x = 0;
            }
            if (this.head.y < 0) {
                this.head.y = gameSize - unit;
            }
            if (this.head.y > gameSize - unit) {
                this.head.y = 0;
            }
        }

        move() {
            this.clear()

            for (let i = this.body.length - 1; i >= 1; i--) {
                this.body[i].x = this.body[i - 1].x;
                this.body[i].y = this.body[i - 1].y;
            }
            this.body[0].x += this.speed.x * unit;
            this.body[0].y += this.speed.y * unit;
            this.handleBound()

            this.draw()
        }

        checkEat(food) {
            let head = this.body[0];
            return food.x === head.x && food.y === head.y;
        }

        grow() {
            this.clear()
            let snakeLength = this.body.length;
            let mountX = this.body[snakeLength - 1].x - this.body[snakeLength - 2].x;
            let mountY = this.body[snakeLength - 1].y - this.body[snakeLength - 2].y;
            let newPart = new taoDo(
                this.body[snakeLength - 1].x + mountX,
                this.body[snakeLength - 1].y + mountY
            )
            this.body.push(newPart);
            this.draw()
        }
    }

    class Food {
        constructor(x, y) {
            this.x = x;
            this.y = y;
        }

        draw() {
            ctx.fillStyle = `green`;
            ctx.fillRect(this.x, this.y, unit, unit);
        }

        clear() {
            ctx.fillStyle = backgroudColor;
            ctx.fillRect(this.x, this.y, unit, unit);
        }

        getRandomNumber() {
            let randomNumber = Math.floor(Math.random() * gameSize);
            randomNumber -= randomNumber % unit;
            return randomNumber
        }

        spawn() {
            this.clear();
            this.x = this.getRandomNumber();
            this.y = this.getRandomNumber();
            this.draw()
        }
    }


    let player = new Snake();
    player.draw()
    let food = new Food();
    food.spawn()

    setInterval(() => {
        player.move()
        if (player.checkEat(food)) {
            player.grow()
            food.spawn()
        }
    }, gameDelay)

    document.onkeydown = function (e) {
        switch (e.keyCode) {
            case left:
                if (currentDirection.x === 1) break;
                player.speed = new taoDo(-1, 0)
                currentDirection = new taoDo(-1, 0)
                break;
            case right:
                if (currentDirection.x === -1) break;
                player.speed = new taoDo(1, 0)
                currentDirection = new taoDo(1, 0)
                break;
            case up:
                if (currentDirection.y === 1) break;
                player.speed = new taoDo(0, -1)
                currentDirection = new taoDo(0, -1)
                break;
            case down:
                if (currentDirection.y === -1) break;

                player.speed = new taoDo(0, 1)
                currentDirection = new taoDo(0, 1)
                break;
            default:
                break;

        }
    }
</script>
</body>
</html>